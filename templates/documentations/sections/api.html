<!-- Section API Documentation -->
<div class="space-y-6">
  <!-- Introduction √† l'API -->
  <div class="bg-white shadow rounded-lg">
    <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
      <h3 class="text-lg font-medium text-gray-900">API REST PW-Analyst</h3>
      <p class="text-sm text-gray-600 mt-1">
        Interface programmable pour int√©grer PW-Analyst dans vos workflows CI/CD
      </p>
    </div>
    <div class="px-6 py-4">
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h4 class="text-sm font-medium text-gray-900 mb-3">
            Fonctionnalit√©s principales
          </h4>
          <ul class="space-y-2 text-sm text-gray-600">
            <li class="flex items-center">
              <svg
                class="h-4 w-4 text-green-500 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5 13l4 4L19 7"
                ></path>
              </svg>
              Import automatique de r√©sultats de tests
            </li>
          </ul>
        </div>

        <div>
          <h4 class="text-sm font-medium text-gray-900 mb-3">URL de base</h4>
          <div class="bg-gray-100 rounded-md p-3">
            <code class="text-sm text-gray-800"
              >/api/projects/{project_id}/upload/</code
            >
          </div>

          <h4 class="text-sm font-medium text-gray-900 mb-3 mt-4">
            Authentification
          </h4>
          <div class="text-sm text-gray-600">
            <p class="mb-2">Header requis :</p>
            <div class="bg-gray-100 rounded-md p-3">
              <code class="text-sm text-gray-800"
                >Authorization: ApiKey &lt;votre-cle&gt;</code
              >
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Exemples d'utilisation -->
  <div class="bg-white shadow rounded-lg">
    <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
      <h3 class="text-lg font-medium text-gray-900">Exemples d'Upload JSON</h3>
    </div>
    <div class="px-6 py-4">
      <div class="space-y-6">
        <!-- Upload JSON direct -->
        <div>
          <h4 class="text-base font-medium text-gray-900 mb-3">
            üöÄ Upload JSON direct (recommand√© pour CI/CD)
          </h4>
          <div class="bg-gray-900 rounded-md p-4 overflow-x-auto">
            <pre
              class="text-sm text-gray-100"
            ><code># Upload JSON Playwright direct
curl -X POST http://localhost:8000/api/projects/1/upload/ \
  -H "X-API-Key: your-api-key-here" \
  -H "Content-Type: application/json" \
  -d @playwright-report.json

# Ou avec les donn√©es en direct
curl -X POST http://localhost:8000/api/projects/1/upload/ \
  -H "X-API-Key: your-api-key-here" \
  -H "Content-Type: application/json" \
  -d '{
    "suites": [
      {
        "title": "tests/example.spec.ts",
        "tests": [
          {
            "title": "should login successfully",
            "status": "passed",
            "duration": 1250,
            "results": [
              {
                "status": "passed",
                "duration": 1250
              }
            ]
          }
        ]
      }
    ],
    "config": {
      "configFile": "playwright.config.ts",
      "version": "1.40.0"
    },
    "stats": {
      "startTime": "2024-01-15T10:30:00.000Z",
      "duration": 5000
    }
  }'</code></pre>
          </div>
        </div>

        <!-- Upload fichier JSON -->
        <div>
          <h4 class="text-base font-medium text-gray-900 mb-3">
            üìÅ Upload de fichier JSON
          </h4>
          <div class="bg-gray-900 rounded-md p-4 overflow-x-auto">
            <pre class="text-sm text-gray-100"><code># Upload d'un fichier JSON
curl -X POST http://localhost:8000/api/projects/1/upload/ \
  -H "X-API-Key: your-api-key-here" \
  -F "file=@playwright-results.json"

# Dans un script CI (GitHub Actions)
- name: Upload results to PW-Analyst
  run: |
    curl -X POST ${'${{ secrets.PW_ANALYST_URL }}'}/api/projects/1/upload/ \
      -H "X-API-Key: ${'${{ secrets.PW_ANALYST_API_KEY }}'}" \
      -F "file=@test-results/results.json"</code></pre>
          </div>
        </div>

        <!-- Script Python -->
        <div>
          <h4 class="text-base font-medium text-gray-900 mb-3">
            üêç Script Python pour automatisation
          </h4>
          <div class="bg-gray-900 rounded-md p-4 overflow-x-auto">
            <pre class="text-sm text-gray-100"><code>import requests
import json
import os

# Configuration
API_BASE = "http://localhost:8000/api"
API_KEY = os.getenv("PW_ANALYST_API_KEY", "your-api-key-here")
PROJECT_ID = 1

headers = {
    "X-API-Key": API_KEY
}

# M√©thode 1: Upload JSON direct
def upload_json_data(json_data):
    headers["Content-Type"] = "application/json"
    response = requests.post(
        f"{API_BASE}/projects/{PROJECT_ID}/upload/",
        headers=headers,
        json=json_data
    )
    return response

# M√©thode 2: Upload fichier JSON
def upload_json_file(file_path):
    with open(file_path, 'rb') as f:
        files = {'file': f}
        response = requests.post(
            f"{API_BASE}/projects/{PROJECT_ID}/upload/",
            headers={"X-API-Key": API_KEY},  # Sans Content-Type pour multipart
            files=files
        )
    return response

# Exemple d'utilisation
if __name__ == "__main__":
    # Chargement du fichier JSON Playwright
    with open("test-results/results.json", "r") as f:
        playwright_data = json.load(f)

    # Upload des donn√©es
    response = upload_json_data(playwright_data)

    if response.status_code == 201:
        result = response.json()
        print(f"‚úÖ Upload r√©ussi!")
        print(f"üîó Ex√©cution: {result['execution_url']}")
        print(f"üìä ID: {result['execution_id']}")
    else:
        print(f"‚ùå Erreur: {response.status_code}")
        print(f"üìù Message: {response.text}")</code></pre>
          </div>
        </div>

        <!-- Structure JSON attendue -->
        <div>
          <h4 class="text-base font-medium text-gray-900 mb-3">
            üìã Structure JSON Playwright attendue
          </h4>
          <div class="bg-gray-50 border border-gray-200 rounded-md p-4">
            <p class="text-sm text-gray-600 mb-3">
              Le JSON doit respecter le format de sortie standard de Playwright.
              Structure minimale requise :
            </p>
            <div class="bg-gray-900 rounded-md p-4 overflow-x-auto">
              <pre class="text-sm text-gray-100"><code>{
  "suites": [
    {
      "title": "nom-du-fichier-test.spec.ts",
      "tests": [
        {
          "title": "nom du test",
          "status": "passed|failed|skipped|timedOut",
          "duration": 1250,
          "results": [
            {
              "status": "passed|failed|skipped|timedOut",
              "duration": 1250,
              "error": {
                "message": "Message d'erreur (optionnel)"
              }
            }
          ]
        }
      ]
    }
  ],
  "config": {
    "configFile": "playwright.config.ts",
    "version": "1.40.0"
  },
  "stats": {
    "startTime": "2024-01-15T10:30:00.000Z",
    "duration": 5000
  }
}</code></pre>
            </div>
            <div class="mt-3 text-xs text-gray-500">
              <span class="font-medium">üí° Conseil :</span> Utilisez directement
              la sortie JSON de Playwright avec <code>--reporter=json</code>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- R√©ponses API -->
  <div class="bg-white shadow rounded-lg">
    <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
      <h3 class="text-lg font-medium text-gray-900">
        R√©ponses de l'API Upload
      </h3>
    </div>
    <div class="px-6 py-4">
      <div class="space-y-6">
        <!-- Succ√®s -->
        <div>
          <h4
            class="text-base font-medium text-gray-900 mb-3 flex items-center"
          >
            <span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
            Succ√®s (201 Created)
          </h4>
          <div class="bg-gray-900 rounded-md p-4 overflow-x-auto">
            <pre class="text-sm text-gray-100"><code>{
  "message": "R√©sultats import√©s avec succ√®s",
  "status": "success",
  "execution_id": 123,
  "execution_url": "{{ request.build_absolute_uri }}/execution/123/",
  "project": "Mon Projet",
  "created_at": "2024-01-15T10:35:25.123Z"
}</code></pre>
          </div>
        </div>

        <!-- Erreurs courantes -->
        <div>
          <h4
            class="text-base font-medium text-gray-900 mb-3 flex items-center"
          >
            <span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>
            Erreurs courantes
          </h4>
          <div class="space-y-3">
            <div class="border border-red-200 bg-red-50 rounded-md p-3">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-red-800"
                  >Projet non trouv√©</span
                >
                <span class="text-xs px-2 py-1 bg-red-200 text-red-800 rounded"
                  >404</span
                >
              </div>
              <code class="text-xs text-red-700"
                >{"error": "Projet non trouv√©", "status": "error"}</code
              >
            </div>

            <div class="border border-red-200 bg-red-50 rounded-md p-3">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-red-800"
                  >Cl√© API invalide</span
                >
                <span class="text-xs px-2 py-1 bg-red-200 text-red-800 rounded"
                  >401</span
                >
              </div>
              <code class="text-xs text-red-700"
                >{"error": "Cl√© API invalide", "status": "error"}</code
              >
            </div>

            <div class="border border-red-200 bg-red-50 rounded-md p-3">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-red-800"
                  >JSON invalide</span
                >
                <span class="text-xs px-2 py-1 bg-red-200 text-red-800 rounded"
                  >400</span
                >
              </div>
              <code class="text-xs text-red-700"
                >{"error": "JSON invalide: ...", "status": "error"}</code
              >
            </div>

            <div class="border border-red-200 bg-red-50 rounded-md p-3">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-red-800"
                  >Structure manquante</span
                >
                <span class="text-xs px-2 py-1 bg-red-200 text-red-800 rounded"
                  >400</span
                >
              </div>
              <code class="text-xs text-red-700"
                >{"error": "Structure JSON invalide: \"suites\" manquant",
                "status": "error"}</code
              >
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Gestion des cl√©s API -->
  <div class="bg-white shadow rounded-lg">
    <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
      <h3 class="text-lg font-medium text-gray-900">Gestion des Cl√©s API</h3>
    </div>
    <div class="px-6 py-4">
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h4 class="text-sm font-medium text-gray-900 mb-3">
            Obtenir une cl√© API
          </h4>
          <ol class="space-y-2 text-sm text-gray-600">
            <li class="flex">
              <span
                class="flex-shrink-0 w-5 h-5 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-xs font-medium mr-3 mt-0.5"
                >1</span
              >
              <span>Connectez-vous avec un compte Manager ou Admin</span>
            </li>
            <li class="flex">
              <span
                class="flex-shrink-0 w-5 h-5 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-xs font-medium mr-3 mt-0.5"
                >2</span
              >
              <span>Acc√©dez √† votre profil utilisateur</span>
            </li>
            <li class="flex">
              <span
                class="flex-shrink-0 w-5 h-5 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-xs font-medium mr-3 mt-0.5"
                >3</span
              >
              <span>G√©n√©rez une nouvelle cl√© API</span>
            </li>
            <li class="flex">
              <span
                class="flex-shrink-0 w-5 h-5 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-xs font-medium mr-3 mt-0.5"
                >4</span
              >
              <span
                >Copiez et sauvegardez la cl√© (elle ne sera plus affich√©e)</span
              >
            </li>
          </ol>
        </div>

        <div>
          <h4 class="text-sm font-medium text-gray-900 mb-3">S√©curit√©</h4>
          <ul class="space-y-2 text-sm text-gray-600">
            <li class="flex items-start">
              <span
                class="flex-shrink-0 h-1.5 w-1.5 bg-gray-400 rounded-full mt-2 mr-3"
              ></span>
              <span>Ne partagez jamais vos cl√©s API</span>
            </li>
            <li class="flex items-start">
              <span
                class="flex-shrink-0 h-1.5 w-1.5 bg-gray-400 rounded-full mt-2 mr-3"
              ></span>
              <span>Utilisez des cl√©s diff√©rentes par environnement</span>
            </li>
            <li class="flex items-start">
              <span
                class="flex-shrink-0 h-1.5 w-1.5 bg-gray-400 rounded-full mt-2 mr-3"
              ></span>
              <span>R√©voquez les cl√©s compromises imm√©diatement</span>
            </li>
            <li class="flex items-start">
              <span
                class="flex-shrink-0 h-1.5 w-1.5 bg-gray-400 rounded-full mt-2 mr-3"
              ></span>
              <span>Les cl√©s h√©ritent des permissions de l'utilisateur</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
