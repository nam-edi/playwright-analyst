{% extends "admin/base_site.html" %} {% load i18n admin_urls static %} {% block
title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock
%} {% block branding %}
<div class="admin-branding">
  <h1 id="site-name">
    <a href="{% url 'admin:index' %}">🎭 PW Analyst Admin</a>
  </h1>
  <p class="admin-subtitle">Tableau de bord d'analyse des tests Playwright</p>
</div>
{% endblock %} {% block nav-global %}{% endblock %} {% block content %}
<div class="admin-dashboard">
  <!-- Header avec informations principales -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1>🚀 Bienvenue dans PW Analyst</h1>
      <p class="dashboard-subtitle">
        Analysez et surveillez vos tests Playwright en temps réel
      </p>
    </div>
    <div class="header-status">
      <div class="status-indicator healthy">
        <span class="status-dot"></span>
        <span class="status-text">Système opérationnel</span>
      </div>
    </div>
  </div>

  <!-- Actions rapides -->
  <div class="quick-actions">
    <h2>🚀 Actions rapides</h2>
    <div class="actions-grid">
      <a href="{% url 'admin:core_test_add' %}" class="action-card add">
        <div class="action-icon">➕</div>
        <div class="action-content">
          <h3>Nouveau test</h3>
          <p>Ajouter un test manuellement</p>
        </div>
      </a>

      <a
        href="{% url 'admin:core_testexecution_add' %}"
        class="action-card execute"
      >
        <div class="action-icon">▶️</div>
        <div class="action-content">
          <h3>Nouvelle exécution</h3>
          <p>Lancer une exécution de tests</p>
        </div>
      </a>

      <a href="/upload_json/" class="action-card upload">
        <div class="action-icon">📤</div>
        <div class="action-content">
          <h3>Importer JSON</h3>
          <p>Uploader résultats Playwright</p>
        </div>
      </a>

      <a href="/fetch_from_ci/" class="action-card sync">
        <div class="action-icon">🔄</div>
        <div class="action-content">
          <h3>Sync CI/CD</h3>
          <p>Récupérer depuis CI</p>
        </div>
      </a>
    </div>
  </div>

  <!-- Gestion des données -->
  <div class="data-management">
    <h2>📊 Gestion des données</h2>
    <div class="management-grid">
      <a
        href="{% url 'admin:core_test_changelist' %}"
        class="management-card tests"
      >
        <div class="card-header">
          <div class="card-icon">🧪</div>
          <h3>Tests</h3>
        </div>
        <p>Gérer tous les tests et leurs configurations</p>
        <div class="card-action">Voir tous les tests →</div>
      </a>

      <a
        href="{% url 'admin:core_testexecution_changelist' %}"
        class="management-card executions"
      >
        <div class="card-header">
          <div class="card-icon">▶️</div>
          <h3>Exécutions</h3>
        </div>
        <p>Historique et détails des exécutions</p>
        <div class="card-action">Voir les exécutions →</div>
      </a>

      <a
        href="{% url 'admin:core_testresult_changelist' %}"
        class="management-card results"
      >
        <div class="card-header">
          <div class="card-icon">📋</div>
          <h3>Résultats</h3>
        </div>
        <p>Résultats détaillés des tests</p>
        <div class="card-action">Voir les résultats →</div>
      </a>

      <a
        href="{% url 'admin:core_project_changelist' %}"
        class="management-card projects"
      >
        <div class="card-header">
          <div class="card-icon">🏗️</div>
          <h3>Projets</h3>
        </div>
        <p>Organisation par projets</p>
        <div class="card-action">Gérer les projets →</div>
      </a>
    </div>
  </div>

  <!-- Outils d'analyse -->
  <div class="analysis-tools">
    <h2>📈 Outils d'analyse</h2>
    <div class="tools-grid">
      <a
        href="{% url 'admin:core_testresult_changelist' %}?status__exact=failed"
        class="tool-card failed"
      >
        <div class="tool-icon">❌</div>
        <div class="tool-content">
          <h3>Tests en échec</h3>
          <p>Analyser les échecs récents</p>
        </div>
      </a>

      <a
        href="{% url 'admin:core_testresult_changelist' %}?status__exact=flaky"
        class="tool-card flaky"
      >
        <div class="tool-icon">⚡</div>
        <div class="tool-content">
          <h3>Tests instables</h3>
          <p>Identifier les tests problématiques</p>
        </div>
      </a>

      <a
        href="{% url 'admin:core_testexecution_changelist' %}"
        class="tool-card trends"
      >
        <div class="tool-icon">📊</div>
        <div class="tool-content">
          <h3>Tableau de bord</h3>
          <p>Vue d'ensemble détaillée</p>
        </div>
      </a>
    </div>
  </div>

  <!-- Configuration système -->
  <div class="system-config">
    <h2>⚙️ Configuration</h2>
    <div class="config-grid">
      <a
        href="{% url 'admin:core_ciconfiguration_changelist' %}"
        class="config-card ci"
      >
        <div class="config-icon">🔧</div>
        <div class="config-content">
          <h3>CI/CD</h3>
          <p>Configuration des intégrations continues</p>
        </div>
      </a>

      <a href="/admin/auth/user/" class="config-card users">
        <div class="config-icon">👥</div>
        <div class="config-content">
          <h3>Utilisateurs</h3>
          <p>Gestion des accès et permissions</p>
        </div>
      </a>

      <a href="/admin/auth/group/" class="config-card groups">
        <div class="config-icon">👨‍👩‍👧‍👦</div>
        <div class="config-content">
          <h3>Groupes</h3>
          <p>Organisation des équipes</p>
        </div>
      </a>
    </div>
  </div>

  <!-- Informations utiles -->
  <div class="useful-info">
    <div class="info-grid">
      <div class="info-card tips">
        <h3>💡 Conseils d'utilisation</h3>
        <ul>
          <li>
            Importez vos résultats JSON directement depuis votre pipeline CI/CD
          </li>
          <li>Utilisez les filtres pour analyser les tendances par projet</li>
          <li>Configurez les alertes pour être notifié des échecs</li>
          <li>
            Consultez régulièrement les tests instables pour maintenir la
            qualité
          </li>
        </ul>
      </div>

      <div class="info-card links">
        <h3>🔗 Liens utiles</h3>
        <div class="useful-links">
          <a
            href="https://playwright.dev/docs/test-reporters"
            target="_blank"
            class="external-link"
          >
            📖 Documentation Playwright
          </a>
          <a
            href="https://playwright.dev/docs/test-configuration"
            target="_blank"
            class="external-link"
          >
            ⚙️ Configuration des tests
          </a>
          <a
            href="https://playwright.dev/docs/ci"
            target="_blank"
            class="external-link"
          >
            🔄 Intégration CI/CD
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript pour charger les métriques -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Fonction pour charger les métriques via une requête AJAX ou utiliser les données du contexte
    function loadMetrics() {
      // Utiliser les données injectées par le contexte Django s'il y en a
      const totalTests = '{{ total_tests|default:"0" }}';
      const successRate = '{{ success_rate|default:"0" }}';
      const failedTests = '{{ failed_tests|default:"0" }}';
      const activeProjects = '{{ active_projects|default:"0" }}';

      // Mettre à jour les éléments
      const totalTestsEl = document.getElementById("total-tests");
      const successRateEl = document.getElementById("success-rate");
      const failedTestsEl = document.getElementById("failed-tests");
      const activeProjectsEl = document.getElementById("active-projects");

      if (totalTestsEl) totalTestsEl.textContent = totalTests;
      if (successRateEl) successRateEl.textContent = successRate + "%";
      if (failedTestsEl) failedTestsEl.textContent = failedTests;
      if (activeProjectsEl) activeProjectsEl.textContent = activeProjects;

      // Ajouter des animations si les données sont disponibles
      if (totalTests !== "0") {
        document.querySelectorAll(".metric-card").forEach((card) => {
          card.style.opacity = "0";
          card.style.transform = "translateY(20px)";
          setTimeout(() => {
            card.style.transition = "all 0.6s ease";
            card.style.opacity = "1";
            card.style.transform = "translateY(0)";
          }, Math.random() * 300);
        });
      }
    }

    loadMetrics();

    // Optionnel : actualiser les données périodiquement
    // setInterval(loadMetrics, 30000); // Toutes les 30 secondes
  });
</script>

<style>
  /* Branding personnalisé */
  .admin-branding {
    padding: 1rem 0;
  }

  .admin-branding h1 {
    margin: 0;
  }

  .admin-branding h1 a {
    color: #417690;
    text-decoration: none;
    font-size: 1.5rem;
    font-weight: 700;
  }

  .admin-subtitle {
    margin: 0.5rem 0 0 0;
    color: #c2bf30ff;
    font-size: 0.9rem;
  }

  /* Dashboard principal */
  .admin-dashboard {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }

  /* Header */
  .dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding: 2rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 12px;
    color: white;
  }

  .dashboard-header h1 {
    margin: 0;
    font-size: 2.5rem;
    font-weight: 700;
  }

  .dashboard-subtitle {
    margin: 0.5rem 0 0 0;
    opacity: 0.9;
    font-size: 1.2rem;
  }

  .status-indicator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 25px;
    font-size: 0.9rem;
  }

  .status-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #10b981;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
  }

  /* Métriques rapides */
  .quick-metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
  }

  .metric-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    border-left: 4px solid;
    transition: transform 0.2s ease;
  }

  .metric-card:hover {
    transform: translateY(-2px);
  }

  .metric-card.primary {
    border-left-color: #3b82f6;
  }
  .metric-card.success {
    border-left-color: #10b981;
  }
  .metric-card.warning {
    border-left-color: #f59e0b;
  }
  .metric-card.info {
    border-left-color: #06b6d4;
  }

  .metric-icon {
    font-size: 2rem;
    opacity: 0.8;
  }

  .metric-content h3 {
    margin: 0;
    font-size: 2rem;
    font-weight: bold;
    color: #374151;
  }

  .metric-content p {
    margin: 0.25rem 0 0 0;
    color: #6b7280;
    font-size: 0.9rem;
  }

  /* Sections */
  .admin-dashboard > div {
    margin-bottom: 3rem;
  }

  .admin-dashboard h2 {
    color: #c2b828ff;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
    font-weight: 600;
  }

  /* Grilles */
  .actions-grid,
  .management-grid,
  .tools-grid,
  .config-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
  }

  /* Cartes d'action */
  .action-card,
  .management-card,
  .tool-card,
  .config-card {
    display: block;
    padding: 1.5rem;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    text-decoration: none;
    color: inherit;
    transition: all 0.2s ease;
    border-left: 4px solid;
  }

  .action-card:hover,
  .management-card:hover,
  .tool-card:hover,
  .config-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    text-decoration: none;
  }

  .action-card {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .action-card.add {
    border-left-color: #10b981;
  }
  .action-card.execute {
    border-left-color: #3b82f6;
  }
  .action-card.upload {
    border-left-color: #f59e0b;
  }
  .action-card.sync {
    border-left-color: #8b5cf6;
  }

  .action-icon {
    font-size: 2rem;
    opacity: 0.8;
  }

  .action-content h3 {
    margin: 0 0 0.25rem 0;
    color: #374151;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .action-content p {
    margin: 0;
    color: #6b7280;
    font-size: 0.9rem;
  }

  /* Cartes de gestion */
  .management-card.tests {
    border-left-color: #10b981;
  }
  .management-card.executions {
    border-left-color: #3b82f6;
  }
  .management-card.results {
    border-left-color: #f59e0b;
  }
  .management-card.projects {
    border-left-color: #8b5cf6;
  }

  .card-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
  }

  .card-icon {
    font-size: 1.5rem;
  }

  .card-header h3 {
    margin: 0;
    color: #374151;
    font-size: 1.2rem;
    font-weight: 600;
  }

  .management-card p {
    margin: 0 0 1rem 0;
    color: #6b7280;
    line-height: 1.5;
  }

  .card-action {
    color: #3b82f6;
    font-weight: 500;
    font-size: 0.9rem;
  }

  /* Cartes d'outils */
  .tool-card.failed {
    border-left-color: #ef4444;
  }
  .tool-card.flaky {
    border-left-color: #f59e0b;
  }
  .tool-card.trends {
    border-left-color: #06b6d4;
  }

  .tool-card {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .tool-icon {
    font-size: 2rem;
    opacity: 0.8;
  }

  .tool-content h3 {
    margin: 0 0 0.25rem 0;
    color: #374151;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .tool-content p {
    margin: 0;
    color: #6b7280;
    font-size: 0.9rem;
  }

  /* Cartes de configuration */
  .config-card.ci {
    border-left-color: #3b82f6;
  }
  .config-card.users {
    border-left-color: #10b981;
  }
  .config-card.groups {
    border-left-color: #8b5cf6;
  }

  .config-card {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .config-icon {
    font-size: 2rem;
    opacity: 0.8;
  }

  .config-content h3 {
    margin: 0 0 0.25rem 0;
    color: #374151;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .config-content p {
    margin: 0;
    color: #6b7280;
    font-size: 0.9rem;
  }

  /* Informations utiles */
  .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 1.5rem;
  }

  .info-card {
    padding: 1.5rem;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }

  .info-card h3 {
    margin: 0 0 1rem 0;
    color: #374151;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .info-card ul {
    margin: 0;
    padding-left: 1.5rem;
  }

  .info-card li {
    margin-bottom: 0.5rem;
    color: #6b7280;
    line-height: 1.5;
  }

  .useful-links {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .external-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem;
    color: #3b82f6;
    text-decoration: none;
    border-radius: 6px;
    transition: background-color 0.2s;
  }

  .external-link:hover {
    background: #f3f4f6;
    text-decoration: none;
  }

  /* Design responsive */
  @media (max-width: 768px) {
    .admin-dashboard {
      padding: 1rem;
    }

    .dashboard-header {
      flex-direction: column;
      text-align: center;
      gap: 1rem;
      padding: 1.5rem;
    }

    .dashboard-header h1 {
      font-size: 2rem;
    }

    .quick-metrics {
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .actions-grid,
    .management-grid,
    .tools-grid,
    .config-grid {
      grid-template-columns: 1fr;
    }

    .info-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 480px) {
    .quick-metrics {
      grid-template-columns: 1fr;
    }

    .action-card,
    .tool-card,
    .config-card {
      flex-direction: column;
      text-align: center;
      gap: 0.75rem;
    }

    .card-header {
      justify-content: center;
    }
  }
</style>
{% endblock %}
