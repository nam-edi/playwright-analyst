<!-- Fragment pour afficher/éditer le commentaire du test -->
<div id="comment-section" class="mt-3">
  <div class="flex items-center justify-between mb-2">
    <div class="text-xs text-gray-600">Commentaire:</div>
    {% if user_permissions.can_modify %}
    <button
      id="edit-comment-btn"
      class="text-xs text-blue-600 hover:text-blue-800 transition-colors"
      onclick="toggleCommentEdit()"
    >
      {% if test.comment %}Modifier{% else %}Ajouter{% endif %}
    </button>
    {% endif %}
  </div>

  <!-- Affichage du commentaire -->
  <div
    id="comment-display"
    {%
    if
    not
    test.comment
    %}style="display: none;"
    {%
    endif
    %}
  >
    <p class="text-sm text-gray-700 bg-gray-50 p-2 rounded whitespace-pre-wrap">
      {{ test.comment|default:"Aucun commentaire" }}
    </p>
  </div>

  <!-- Formulaire d'édition -->
  <div id="comment-edit" style="display: none">
    <form
      hx-post="{% url 'update_test_comment' test.id %}"
      hx-target="#comment-section"
      hx-swap="outerHTML"
      class="space-y-2"
    >
      {% csrf_token %}
      <textarea
        name="comment"
        rows="3"
        class="w-full text-sm border border-gray-300 rounded-md p-2 focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
        placeholder="Ajoutez votre commentaire..."
      >
{{ test.comment }}</textarea
      >
      <div class="flex gap-2">
        <button
          type="submit"
          class="px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition-colors"
        >
          Sauvegarder
        </button>
        <button
          type="button"
          onclick="toggleCommentEdit()"
          class="px-3 py-1 bg-gray-300 text-gray-700 text-xs rounded hover:bg-gray-400 transition-colors"
        >
          Annuler
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  function toggleCommentEdit() {
    const display = document.getElementById("comment-display");
    const edit = document.getElementById("comment-edit");
    const btn = document.getElementById("edit-comment-btn");

    if (edit.style.display === "none") {
      display.style.display = "none";
      edit.style.display = "block";
      btn.textContent = "Annuler";
    } else {
      display.style.display = "block";
      edit.style.display = "none";
      btn.textContent =
        display.querySelector("p").textContent === "Aucun commentaire"
          ? "Ajouter"
          : "Modifier";
    }
  }
</script>
